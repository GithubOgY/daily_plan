# GAS 資材・売上管理システム

Google Apps Script (GAS) を使用した資材・売上管理システムです。資材の発注から商品の製造、納品、売上記録まで一貫して管理できます。

## 📋 目次

- [機能概要](#機能概要)
- [必要な環境](#必要な環境)
- [セットアップ手順](#セットアップ手順)
- [ファイル構成](#ファイル構成)
- [開発ガイド](#開発ガイド)
- [ドキュメント](#ドキュメント)

## 🎯 機能概要

### 主要機能
- ✅ 資材の発注・受領管理
- ✅ 商品の受注・製造・納品管理
- ✅ BOM（部品表）の登録・管理
- ✅ 在庫の自動管理
- ✅ 売上の自動記録
- ✅ 製造業者の管理
- ✅ Shortage状態の自動解決

### システムの流れ
```
資材発注 → 資材受領 → 在庫増加
商品受注 → 在庫チェック → 製造 → 在庫減少 → 納品 → 売上記録
```

## 🔧 必要な環境

- Googleアカウント
- Googleスプレッドシート
- Google Apps Script エディタ（ブラウザからアクセス可能）

## 🚀 セットアップ手順

### 1. スプレッドシートの作成

1. 新しいGoogleスプレッドシートを作成
2. `sheets_structure.md`の説明に従って、以下の7つのシートを作成：
   - `Materials` (資材マスタ)
   - `Products` (商品マスタ)
   - `BOM` (部品表)
   - `Material_Orders` (資材発注ログ)
   - `Product_Orders` (商品受注ログ)
   - `Sales` (売上ログ)
   - `Manufacturers` (製造業者マスタ)

### 2. Apps Scriptプロジェクトの作成

1. スプレッドシートのメニューから「拡張機能」→「Apps Script」を選択
2. 新しいプロジェクトが開きます

### 3. ファイルの追加

以下のファイルを作成し、コードを貼り付けます：

#### `Code.gs`
- メインのGASコード
- すべてのビジネスロジックを含む

#### `Dialog.html`
- ユーザーインターフェース
- フォームダイアログのHTMLとJavaScript

### 4. 初期データの登録

各マスタシートに初期データを登録してください：

- **Materials**: 使用する資材を登録
- **Products**: 販売する商品を登録
- **Manufacturers**: 製造業者を登録
- **BOM**: 商品に必要な資材を登録

### 5. 動作確認

1. スプレッドシートに戻る
2. ページを再読み込み（F5キー）
3. メニューバーに「資材管理システム」が表示されることを確認

## 📁 ファイル構成

```
GAS_Material_System/
├── Code.gs                    # メインのGASコード
├── Dialog.html                # ユーザーインターフェース
├── sheets_structure.md        # シート構造の説明
├── USER_MANUAL.md             # ユーザー向け取り扱い説明書
├── DEVELOPMENT_LOG.md         # 開発ログ
└── README.md                  # このファイル
```

## 👨‍💻 開発ガイド

### 開発環境のセットアップ

1. このリポジトリをクローンまたはダウンロード
2. Googleスプレッドシートを作成
3. Apps Scriptプロジェクトを作成
4. ファイルをコピー＆ペースト

### コードの構造

#### `Code.gs`の主要な関数

- `onOpen()`: メニューの作成
- `openOrderMaterialDialog()`: 資材発注ダイアログを開く
- `openProductOrderDialog()`: 商品受注ダイアログを開く
- `openBOMDialog()`: BOM登録ダイアログを開く
- `menuReceiveMaterial()`: 資材受領処理
- `menuManufactureProduct()`: 商品製造処理
- `menuDeliverProduct()`: 商品納品処理
- `processForm()`: フォーム送信処理
- `registerBOM()`: BOM登録処理
- `checkAndResolveShortageOrders()`: Shortage状態の自動解決

#### `Dialog.html`の主要な関数

- `init()`: フォームの初期化
- `addBomMaterialField()`: BOM資材フィールドの追加
- `handleSubmit()`: フォーム送信処理

### 開発時の注意事項

1. **数値の扱い**: スプレッドシートから取得した値は文字列の可能性があるため、`Number()`で変換
2. **エラーハンドリング**: すべての主要な関数でエラーハンドリングを実装
3. **データ検証**: 入力値の検証を必ず行う
4. **ログ**: デバッグ用に`Logger.log()`を使用

### テスト方法

1. 各機能を個別にテスト
2. エッジケース（空データ、不正な値など）をテスト
3. ブラウザの開発者ツール（F12）でコンソールエラーを確認
4. Apps Scriptの実行ログを確認

## 📚 ドキュメント

- **`USER_MANUAL.md`**: ユーザー向けの取り扱い説明書
- **`DEVELOPMENT_LOG.md`**: 開発履歴と技術的な詳細
- **`sheets_structure.md`**: シート構造の詳細な説明

## 🔄 バージョン管理

### 現在のバージョン
- **バージョン**: 1.2
- **最終更新**: 2024年

### 変更履歴
詳細は`DEVELOPMENT_LOG.md`を参照してください。

#### バージョン1.2の主な変更点
- 資材発注機能を複数品目対応に拡張（最大10品目）
- 資材発注機能のバグ修正（数量チェック、変数重複宣言）

#### バージョン1.1の主な変更点
- 発注番号を6桁から7桁に変更
- 商品番号入力時の自動補完機能を改善
- Productsシート構造の変更に対応（伝票単価列の追加）
- 資材発注時に受領予定日を入力可能に
- 資材発注時に資材名を自動記録

## ⚠️ 注意事項

1. **シート名の変更**: シート名を変更する場合は、`Code.gs`の`SHEET_NAMES`定数も更新してください
2. **列の追加**: シートに列を追加する場合は、コード内の列番号を確認してください
3. **データの直接編集**: システムが自動更新する列は直接編集しないでください
4. **バックアップ**: 重要なデータは定期的にバックアップを取ってください

## 🐛 トラブルシューティング

### メニューが表示されない
- スプレッドシートを再読み込み（F5キー）
- Apps Scriptでコードが正しく保存されているか確認
- ブラウザのキャッシュをクリア

### エラーが発生する
- ブラウザの開発者ツール（F12）のコンソールを確認
- Apps Scriptの実行ログを確認
- `DEVELOPMENT_LOG.md`のトラブルシューティングセクションを参照

## 📝 ライセンス

このプロジェクトは内部使用を目的としています。

## 👥 開発者向け情報

### コードの拡張方法

新しい機能を追加する場合：

1. `Code.gs`に新しい関数を追加
2. `onOpen()`にメニュー項目を追加
3. 必要に応じて`Dialog.html`を拡張
4. `DEVELOPMENT_LOG.md`に変更内容を記録

### デバッグ方法

1. Apps Scriptエディタで`Logger.log()`を使用
2. 実行ログを確認（「表示」→「ログ」）
3. ブラウザの開発者ツールでコンソールエラーを確認

---

**開発者向けの詳細情報**: `DEVELOPMENT_LOG.md`を参照してください。

